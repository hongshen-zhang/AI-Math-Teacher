import{_ as E,r as u,o as i,e as V,w as t,a as e,l as w,v as C,s as F,b as o,k as H,c as f,g,T as G,F as v,d as I,i as x,t as c,p as K,f as M}from"./index-8a54ecfc.js";import{C as X}from"./custom-input-c06b03e0.js";const Y={data(){return{isShow:!1,title:"",form:{type:0},formWidth:"500px"}},computed:{typeName(){return this.form.type===0?"知识点":"题目"}},methods:{show(s){s?this.title="编辑":this.title="新增",this.isShow=!0},beforeClose(){this.isShow=!1},onTypeChange(s){s==="题目"&&(this.form.type=1,this.resetForm({type:1})),s==="知识点"&&(this.form.type=0,this.resetForm({type:0}))},resetForm(s){this.form=Object.assign({type:0,content:"",question:"",answer:""},s)}}};function Z(s,r,z,h,n,p){const R=u("el-radio-button"),q=u("el-radio-group"),_=u("el-form-item"),b=u("el-input"),U=u("el-button"),k=u("el-form"),a=u("el-dialog");return i(),V(a,{modelValue:n.isShow,"onUpdate:modelValue":r[3]||(r[3]=y=>n.isShow=y),title:n.title,width:"30%","before-close":()=>p.beforeClose()},{default:t(()=>[e(k,{model:n.form,"label-width":"120px"},{default:t(()=>[e(_,{prop:"type"},{default:t(()=>[e(q,{class:"type-radio","model-value":p.typeName,onChange:p.onTypeChange},{default:t(()=>[e(R,{label:"知识点"}),e(R,{label:"题目"})]),_:1},8,["model-value","onChange"])]),_:1}),w(e(_,{label:"题目：",prop:"question",style:F({width:n.formWidth})},{default:t(()=>[e(b,{modelValue:n.form.content,"onUpdate:modelValue":r[0]||(r[0]=y=>n.form.content=y),autosize:{minRows:5,maxRows:7},type:"textarea"},null,8,["modelValue"])]),_:1},8,["style"]),[[C,n.form.type===1]]),w(e(_,{label:"答案：",prop:"amswer",style:F({width:n.formWidth})},{default:t(()=>[e(b,{modelValue:n.form.content,"onUpdate:modelValue":r[1]||(r[1]=y=>n.form.content=y),autosize:{minRows:5,maxRows:7},type:"textarea"},null,8,["modelValue"])]),_:1},8,["style"]),[[C,n.form.type===1]]),e(_,{label:"知识点：",prop:"content",style:F({width:n.formWidth})},{default:t(()=>[e(b,{modelValue:n.form.content,"onUpdate:modelValue":r[2]||(r[2]=y=>n.form.content=y),autosize:{minRows:5,maxRows:7},type:"textarea"},null,8,["modelValue"])]),_:1},8,["style"]),e(_,null,{default:t(()=>[e(U,{type:"primary"},{default:t(()=>[o("确认")]),_:1}),e(U,null,{default:t(()=>[o("取消")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title","before-close"])}const $=E(Y,[["render",Z]]);const ee={components:{ContentDialog:$,CustomInput:X},data(){return{type:0,searchType:"",library:{search:""},libraryLoading:!1,librarys:[],model:{aimodel:"gpt-4",promot:"请回答我的问题，并提供问题所考察的知识点。\n我的问题是: ${question}",question:"",result:"",answer:"",knowledge:"",status:0},modelRules:{promot:[{required:!0,message:"请输入提示词",trigger:"blur"}],question:[{required:!0,message:"请输入题目",trigger:"blur"}]},modelLoading:!1,coursenotes:[],loadingPDF:!1}},computed:{typeName(){return this.type===0?"知识库":"大模型"}},methods:{addContent(s){s==="add"&&this.$refs.contentDialog.show()},onTypeChange(s){s==="大模型"&&(this.type=1),s==="知识库"&&(this.type=0)},onSearchChange(){const s=this.library.search;if(s===""){this.librarys=[];return}this.libraryLoading=!0,this.$axios.get(`/api/questionLibrary/findByKeyword?keyword=${s}&searchType=${this.searchType}`).then(r=>{this.librarys=r.data}).finally(()=>{this.libraryLoading=!1})},solveQuestion(){this.$refs.modelForm.validate((s,r)=>{s?(this.model=Object.assign(this.model,{result:"",answer:"",knowledge:"",status:0}),this.modelLoading=!0,this.$axios.post("/api/chat/completion",this.createCompletion()).then(z=>{this.model.result=this.postHandleReplay(z.data.$response);try{let h=JSON.parse(this.model.result);if(!h.answer)throw new Error;this.model.status=1,this.model.answer=h.answer,this.model.knowledge=h.knowledge}catch(h){console.error(h),this.model.status=2,this.model.answer=this.model.result}},z=>{this.model.status=-1,this.model.result=z.message}).finally(()=>{this.modelLoading=!1})):this.$message.error("请完善设置信息")})},createCompletion(){return{model:this.model.aimodel,messages:[{role:"user",content:this.replaceText(this.model.promot,{question:this.model.question})+'\nReplay Latex format string for the JSON value, Do not add extra structure; Check if the JSON syntax format of the response is correct; Provide output in JSON format as follows: \n{"answer":"${答案}","knowledge":"${知识点}"}'}],temperature:.1}},replaceText(s,r){return s.replace(/\${(\w+)}/g,function(z,h){return r[h]||z})},addToNotes(s){this.$message.success("添加成功"),console.log(s),this.coursenotes.push(s)},submitQuestion(){let s={type:0,question:this.model.question,answer:this.model.answer,knowledge:this.model.knowledge};this.coursenotes.push(s)},removeNote(s){this.coursenotes.splice(s,1)},downloadPDF(s="v2"){if(this.coursenotes.length===0){this.$message.error("请添加题目或知识点");return}this.loadingPDF=!0,this.$axios.post("/api/pdf/coursenote",{notes:this.coursenotes,version:s}).then(r=>{this.pdfUrl=this.$fileserver.fileurl(r.data.fileUrl),window.open(this.pdfUrl)}).finally(()=>this.loadingPDF=!1)},postHandleReplay(s){return s.startsWith("```json")&&(s=s.substring(7,s.length-3)),s.endsWith("```")&&(s=s.substring(0,s.length-3)),s},libraryTypeName(s){switch(s){case 0:return"题库";case 1:return"知识点";case 2:return"作业批改";default:return""}}}},O=s=>(K("data-v-3ffbb711"),s=s(),M(),s),te={class:"container-wrapper"},le={class:"card-header"},oe=O(()=>g("span",null,"配置",-1)),ae={key:0,class:"library-container"},se={class:"content-list"},ne={class:"box-card-header"},re={class:"model-container"},de={class:"result-card"},ue={style:{width:"100%","text-align":"right"}},ie={class:"card-header"},me=O(()=>g("span",null,"讲义",-1)),pe={class:"result-wrapper"},ce={class:"content-card_options"};function _e(s,r,z,h,n,p){const R=u("el-radio-button"),q=u("el-radio-group"),_=u("el-option"),b=u("el-select"),U=u("el-input"),k=u("el-button"),a=u("el-text"),y=u("el-scrollbar"),N=u("el-card"),T=u("el-form-item"),m=u("custom-input"),W=u("el-form"),J=u("arrow-down"),L=u("el-icon"),P=u("el-dropdown-item"),Q=u("el-dropdown-menu"),j=u("el-dropdown"),A=u("Delete"),B=u("el-radio"),S=H("loading");return i(),f("div",te,[e(N,{class:"left-bar"},{header:t(()=>[g("div",le,[oe,e(q,{class:"type-radio","model-value":p.typeName,onChange:p.onTypeChange},{default:t(()=>[e(R,{label:"知识库"}),e(R,{label:"大模型"})]),_:1},8,["model-value","onChange"])])]),default:t(()=>[n.type===0?(i(),f("div",ae,[e(U,{modelValue:n.library.search,"onUpdate:modelValue":r[1]||(r[1]=l=>n.library.search=l),placeholder:"请输入题目",class:"search-bar",size:"large","suffix-icon":"search",onChange:p.onSearchChange},{prepend:t(()=>[e(b,{size:"large",onChange:p.onSearchChange,modelValue:n.searchType,"onUpdate:modelValue":r[0]||(r[0]=l=>n.searchType=l),style:{width:"110px"}},{default:t(()=>[e(_,{label:"全部",value:""}),e(_,{label:"题库",value:"0"}),e(_,{label:"知识点",value:"1"}),e(_,{label:"作业批改",value:"2"})]),_:1},8,["onChange","modelValue"])]),_:1},8,["modelValue","onChange"]),e(y,null,{default:t(()=>[w((i(),f("div",se,[e(G,{name:".el-zoom-in-top"},{default:t(()=>[(i(!0),f(v,null,I(n.librarys,l=>(i(),V(N,{key:l.id,class:"content-list-item"},{header:t(()=>[g("div",ne,[g("span",null,c(p.libraryTypeName(l.type)),1),e(k,{type:"primary",style:{width:"70px"},onClick:D=>p.addToNotes(l)},{default:t(()=>[o("选择")]),_:2},1032,["onClick"])])]),default:t(()=>[e(y,{"max-height":"200px",style:{"user-select":"text"}},{default:t(()=>[l.type===0?(i(),V(a,{key:0},{default:t(()=>[e(a,{class:"text-content",size:"large",tag:"p",type:"primary"},{default:t(()=>[o("题目：")]),_:1}),e(a,{class:"text-content",tag:"p"},{default:t(()=>[o(c(l.question),1)]),_:2},1024),e(a,{class:"text-content",size:"large",tag:"p",type:"primary"},{default:t(()=>[o("答案：")]),_:1}),e(a,{class:"text-content",tag:"p"},{default:t(()=>[o(c(l.answer),1)]),_:2},1024),l.knowledge?(i(),f(v,{key:0},[e(a,{class:"text-content",size:"large",tag:"p",type:"primary"},{default:t(()=>[o("知识点：")]),_:1}),e(a,{class:"text-content",tag:"p"},{default:t(()=>[o(c(l.knowledge),1)]),_:2},1024)],64)):x("",!0)]),_:2},1024)):l.type===1?(i(),V(a,{key:1},{default:t(()=>[e(a,{class:"text-content",size:"large",tag:"p",type:"primary"},{default:t(()=>[o("名称：")]),_:1}),e(a,{class:"text-content",tag:"p"},{default:t(()=>[o(c(l.knowledgeName),1)]),_:2},1024),l.knowledge?(i(),f(v,{key:0},[e(a,{class:"text-content",size:"large",tag:"p",type:"primary"},{default:t(()=>[o("知识点：")]),_:1}),e(a,{class:"text-content",tag:"p"},{default:t(()=>[o(c(l.knowledge),1)]),_:2},1024)],64)):x("",!0)]),_:2},1024)):l.type===2?(i(),V(a,{key:2},{default:t(()=>[e(a,{class:"text-content",size:"large",tag:"p",type:"primary"},{default:t(()=>[o("名称：")]),_:1}),e(a,{class:"text-content",tag:"p"},{default:t(()=>[o(c(l.question),1)]),_:2},1024),e(a,{class:"text-content",size:"large",tag:"p",type:"primary"},{default:t(()=>[o("题目：")]),_:1}),e(a,{class:"text-content",tag:"p"},{default:t(()=>[o(c(l.question),1)]),_:2},1024),e(a,{class:"text-content",size:"large",tag:"p",type:"primary"},{default:t(()=>[o("正确答案：")]),_:1}),e(a,{class:"text-content",tag:"p"},{default:t(()=>[o(c(l.correctAnswer),1)]),_:2},1024),l.knowledge?(i(),f(v,{key:0},[e(a,{class:"text-content",size:"large",tag:"p",type:"primary"},{default:t(()=>[o("知识点：")]),_:1}),e(a,{class:"text-content",tag:"p"},{default:t(()=>[o(c(l.knowledge),1)]),_:2},1024)],64)):x("",!0),e(a,{class:"text-content",size:"large",tag:"p",type:"primary"},{default:t(()=>[o("学生答案：")]),_:1}),e(a,{class:"text-content",tag:"p"},{default:t(()=>[o(c(l.answer),1)]),_:2},1024),e(a,{class:"text-content",size:"large",tag:"p",type:"primary"},{default:t(()=>[o("是否正确：")]),_:1}),e(a,{class:"text-content",type:l.isTrue?"success":"danger",tag:"p"},{default:t(()=>[o(c(l.isTrue?"正确":"错误"),1)]),_:2},1032,["type"]),l.errText?(i(),f(v,{key:1},[e(a,{class:"text-content",size:"large",tag:"p",type:"primary"},{default:t(()=>[o("错误：")]),_:1}),e(a,{class:"text-content",type:l.isTrue?"success":"danger",tag:"p"},{default:t(()=>[o(c(l.errText),1)]),_:2},1032,["type"])],64)):x("",!0),l.comment?(i(),f(v,{key:2},[e(a,{class:"text-content",size:"large",tag:"p",type:"primary"},{default:t(()=>[o("评价：")]),_:1}),e(a,{class:"text-content",tag:"p"},{default:t(()=>[o(c(l.comment),1)]),_:2},1024)],64)):x("",!0)]),_:2},1024)):x("",!0)]),_:2},1024)]),_:2},1024))),128))]),_:1})])),[[S,n.libraryLoading]])]),_:1})])):x("",!0),w(g("div",re,[e(y,null,{default:t(()=>[e(W,{ref:"modelForm",class:"model-form",model:n.model,"label-position":"top",rules:n.modelRules},{default:t(()=>[e(T,{label:"支持模型列表：",prop:"aimodel"},{default:t(()=>[e(b,{modelValue:n.model.aimodel,"onUpdate:modelValue":r[2]||(r[2]=l=>n.model.aimodel=l),style:{width:"100%"}},{default:t(()=>[e(_,{label:"gpt-4",value:"gpt-4"}),e(_,{label:"gpt-3.5-turbo",value:"gpt-3.5-turbo"}),e(_,{label:"ERNIE-Bot",value:"ERNIE-Bot"})]),_:1},8,["modelValue"])]),_:1}),e(T,{label:"提示预览：",prop:"promot"},{default:t(()=>[e(U,{modelValue:n.model.promot,"onUpdate:modelValue":r[3]||(r[3]=l=>n.model.promot=l),autosize:{minRows:5,maxRows:7},type:"textarea"},null,8,["modelValue"])]),_:1}),e(T,{label:"题目：",prop:"question"},{default:t(()=>[e(U,{modelValue:n.model.question,"onUpdate:modelValue":r[4]||(r[4]=l=>n.model.question=l),autosize:{minRows:5,maxRows:7},type:"textarea",placeholder:"请输入题目"},null,8,["modelValue"])]),_:1}),e(T,{label:"输出结果：",prop:"result"},{default:t(()=>[w((i(),f("div",de,[w(g("div",null,[e(a,{class:"text-content",size:"large",tag:"p",type:"primary"},{default:t(()=>[o("答案：")]),_:1}),e(m,{modelValue:n.model.answer,"onUpdate:modelValue":r[5]||(r[5]=l=>n.model.answer=l),type:"textarea",autosize:{minRows:1}},null,8,["modelValue"]),e(a,{class:"text-content",size:"large",tag:"p",type:"primary"},{default:t(()=>[o("知识点：")]),_:1}),e(m,{modelValue:n.model.knowledge,"onUpdate:modelValue":r[6]||(r[6]=l=>n.model.knowledge=l),type:"textarea",autosize:{minRows:1}},null,8,["modelValue"])],512),[[C,n.model.status===1]]),w(g("div",null,[e(a,{class:"text-content",size:"large",tag:"p",type:"warning"},{default:t(()=>[o("解析失败：")]),_:1}),e(m,{modelValue:n.model.answer,"onUpdate:modelValue":r[7]||(r[7]=l=>n.model.answer=l),type:"textarea",color:"warning",autosize:{minRows:1}},null,8,["modelValue"])],512),[[C,n.model.status===2]]),w(g("div",null,[e(a,{class:"text-content",size:"large",tag:"p",type:"danger"},{default:t(()=>[o("错误：")]),_:1}),e(m,{modelValue:n.model.answer,"onUpdate:modelValue":r[8]||(r[8]=l=>n.model.answer=l),type:"textarea",color:"danger",autosize:{minRows:1}},null,8,["modelValue"])],512),[[C,n.model.status===-1]])])),[[S,n.modelLoading]])]),_:1}),e(T,null,{default:t(()=>[g("div",ue,[e(k,{type:"primary",onClick:p.solveQuestion},{default:t(()=>[o("解题")]),_:1},8,["onClick"]),e(k,{type:"primary",onClick:p.submitQuestion},{default:t(()=>[o("提交")]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["model","rules"])]),_:1})],512),[[C,n.type===1]])]),_:1}),e(N,{class:"right-content"},{header:t(()=>[g("div",ie,[me,g("div",null,[e(j,{onCommand:p.downloadPDF},{dropdown:t(()=>[e(Q,null,{default:t(()=>[e(P,{command:"v1"},{default:t(()=>[o("V1")]),_:1}),e(P,{command:"v2"},{default:t(()=>[o("V2")]),_:1})]),_:1})]),default:t(()=>[e(k,{loading:n.loadingPDF,onClick:r[9]||(r[9]=l=>p.downloadPDF("v2")),type:"primary"},{default:t(()=>[o(" 下载PDF "),e(L,{class:"el-icon--right"},{default:t(()=>[e(J)]),_:1})]),_:1},8,["loading"])]),_:1},8,["onCommand"])])])]),default:t(()=>[w((i(),f("div",pe,[e(y,null,{default:t(()=>[(i(!0),f(v,null,I(n.coursenotes,(l,D)=>(i(),f("div",{key:D,class:"content-card"},[g("div",ce,[e(k,{text:""},{default:t(()=>[e(L,{size:15,onClick:d=>p.removeNote(D)},{default:t(()=>[e(A)]),_:2},1032,["onClick"])]),_:2},1024)]),l.type===0?(i(),V(a,{key:0},{default:t(()=>[e(a,{class:"text-content",size:"large",tag:"p",type:"primary"},{default:t(()=>[o("题目：")]),_:1}),e(m,{modelValue:l.question,"onUpdate:modelValue":d=>l.question=d,type:"textarea",autosize:{minRows:1}},null,8,["modelValue","onUpdate:modelValue"]),e(a,{class:"text-content",size:"large",tag:"p",type:"primary"},{default:t(()=>[o("答案：")]),_:1}),e(m,{modelValue:l.answer,"onUpdate:modelValue":d=>l.answer=d,type:"textarea",autosize:{minRows:1}},null,8,["modelValue","onUpdate:modelValue"]),e(a,{class:"text-content",size:"large",tag:"p",type:"primary"},{default:t(()=>[o("知识点：")]),_:1}),e(m,{modelValue:l.knowledge,"onUpdate:modelValue":d=>l.knowledge=d,type:"textarea",autosize:{minRows:1}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):l.type===1?(i(),V(a,{key:1},{default:t(()=>[e(a,{class:"text-content",size:"large",tag:"p",type:"primary"},{default:t(()=>[o("知识点名称：")]),_:1}),e(m,{modelValue:l.knowledgeName,"onUpdate:modelValue":d=>l.knowledgeName=d,type:"textarea",autosize:{minRows:1}},null,8,["modelValue","onUpdate:modelValue"]),e(a,{class:"text-content",size:"large",tag:"p",type:"primary"},{default:t(()=>[o("知识点：")]),_:1}),e(m,{modelValue:l.knowledgeContent,"onUpdate:modelValue":d=>l.knowledgeContent=d,type:"textarea",autosize:{minRows:1}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):l.type===2?(i(),V(a,{key:2},{default:t(()=>[e(a,{class:"text-content",size:"large",tag:"p",type:"primary"},{default:t(()=>[o("名称：")]),_:1}),e(m,{modelValue:l.name,"onUpdate:modelValue":d=>l.name=d,type:"textarea",autosize:{minRows:1}},null,8,["modelValue","onUpdate:modelValue"]),e(a,{class:"text-content",size:"large",tag:"p",type:"primary"},{default:t(()=>[o("题目：")]),_:1}),e(m,{modelValue:l.question,"onUpdate:modelValue":d=>l.question=d,type:"textarea",autosize:{minRows:1}},null,8,["modelValue","onUpdate:modelValue"]),e(a,{class:"text-content",size:"large",tag:"p",type:"primary"},{default:t(()=>[o("正确答案：")]),_:1}),e(m,{modelValue:l.correctAnswer,"onUpdate:modelValue":d=>l.correctAnswer=d,type:"textarea",autosize:{minRows:1}},null,8,["modelValue","onUpdate:modelValue"]),e(a,{class:"text-content",size:"large",tag:"p",type:"primary"},{default:t(()=>[o("知识点：")]),_:1}),e(m,{modelValue:l.knowledge,"onUpdate:modelValue":d=>l.knowledge=d,type:"textarea",autosize:{minRows:1}},null,8,["modelValue","onUpdate:modelValue"]),e(a,{class:"text-content",size:"large",tag:"p",type:"primary"},{default:t(()=>[o("学生答案：")]),_:1}),e(m,{modelValue:l.answer,"onUpdate:modelValue":d=>l.answer=d,type:"textarea",autosize:{minRows:1}},null,8,["modelValue","onUpdate:modelValue"]),e(a,{class:"text-content",size:"large",tag:"p",type:"primary"},{default:t(()=>[o("是否正确：")]),_:1}),e(q,{modelValue:l.isTrue,"onUpdate:modelValue":d=>l.isTrue=d},{default:t(()=>[e(B,{label:1},{default:t(()=>[o("正确")]),_:1}),e(B,{label:0},{default:t(()=>[o("错误")]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"]),e(a,{class:"text-content",size:"large",tag:"p",type:"primary"},{default:t(()=>[o("错误：")]),_:1}),e(m,{modelValue:l.errText,"onUpdate:modelValue":d=>l.errText=d,type:"textarea",autosize:{minRows:1}},null,8,["modelValue","onUpdate:modelValue"]),e(a,{class:"text-content",size:"large",tag:"p",type:"primary"},{default:t(()=>[o("评价：")]),_:1}),e(m,{modelValue:l.comment,"onUpdate:modelValue":d=>l.comment=d,type:"textarea",autosize:{minRows:1}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):x("",!0)]))),128))]),_:1})])),[[S,s.loading]])]),_:1})])}const ye=E(ee,[["render",_e],["__scopeId","data-v-3ffbb711"]]);export{ye as default};
