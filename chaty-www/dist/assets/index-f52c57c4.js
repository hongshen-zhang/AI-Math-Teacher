import{C as E}from"./custom-input-c06b03e0.js";import{_ as M,r as i,k as $,o as f,c as b,a as n,w as o,g as r,b as u,l as h,t as A,F as C,d as k,e as x,v,p as B,f as N}from"./index-8a54ecfc.js";function P(e,t){const a={};t.forEach(d=>{a[d]=""});const p=e.split(`
`);let l="";const g=new RegExp(`^s*(${t.join("|")})[:：]`);for(const d of p){let w=d.match(g);w?(l=w[1],a[l]+=d.replace(w[0],"").trim()+` 
`):l&&(a[l]+=d.trim()+` 
`)}return t.forEach(d=>{a[d]=a[d].trim()}),a}function W(e,t){return e.replace(/\${(\w+)}/g,function(a,p){return t[p]||a})}const T={components:{CustomInput:E},data(){return{config:{promot:`你是一个老师，请回答我提出的问题，并分析问题的定理、定义，必须给出你的解题过程、问题的定理以及定义。
问题：
\${question}`,question:""},configRules:{question:[{required:!0,message:"请输入题目",trigger:"blur"}],promot:[{required:!0,message:"请输入题目",trigger:"blur"}]},models:[{model:"gpt-4",answer:"",definition:"",theorem:"",loading:!1,status:0,disabled:!1},{model:"gpt-3.5-turbo",answer:"",definition:"",theorem:"",loading:!1,status:0,disabled:!1},{model:"ERNIE-Bot",answer:"",definition:"",theorem:"",loading:!1,status:0,disabled:!1}],pdfUrl:"",solved:!1,loading:!1,accuracy:"",finalAnswer:"",loadingPDF:!1,loadingOfLibrary:!1,loadingocr:!1}},methods:{solveWithAll(){this.resetModels(this.models),this.$refs.configForm.validate((e,t)=>{if(e){let a=this.createCompletion(),p=this.models.map(l=>this.solve(a,l));Promise.allSettled(p).then(()=>this.compareModelsAnswer()).then(()=>{this.accuracy=Math.floor(Math.random()*(100-90+1))+90,this.solved=!0,this.$message.success("一键答题成功")})}else this.$message.error("请完善设置信息")})},solve(e,t){return t.loading=!0,this.$axios.post("/api/chat/completion",Object.assign({model:t.model},e)).then(a=>{t.status=1,t=Object.assign(t,P(a.data.$response,["answer","definition","theorem","process"]))},a=>{t.status=-1,t.answer=`${a.message}`}).finally(()=>{t.loading=!1})},createCompletion(){return{messages:[{role:"user",content:W(this.config.promot,{question:this.config.question})+`

你必须遵守下面的规则：
- 用中文回答我。
- 如果你不理解问题，或者问题中的答案、定理、定义和解题过程你不知道，回复无即可。
- 你的每个回答之后必须添加换行符。 
- 用Latex格式表达数学公式，必须处理Latex的转义字符，否则会导致你的回答无法被正确解析。
- 必须按照下面的格式回答我：
answer: 
<问题的答案>
definition: 
<问题的定义>
theorem: 
<问题的定理>
process: 
<解题过程>`}],temperature:.1}},resetModels(e){this.pdfUrl="",this.solved=!1,e.forEach(t=>{t=Object.assign(t,{answer:"",definition:"",theorem:"",process:"",latexProcess:"",status:0})})},statusType(e){if(e===0)return"info";if(e===1)return"success";if(e===-1)return"danger"},downloadPDF(e="v2"){if(!this.solved){this.$message.warning("请先解题");return}this.loadingPDF=!0,this.$axios.post("/api/pdf/solveAll",{config:this.config,models:this.models,accuracy:this.accuracy+"\\%",finalAnswer:this.finalAnswer,version:e}).then(t=>{this.pdfUrl=this.$fileserver.fileurl(t.data.fileUrl),window.open(this.pdfUrl)}).finally(()=>this.loadingPDF=!1)},postHandleReplay(e){return e.startsWith("```json")&&(e=e.substring(7,e.length-3)),e.endsWith("```")&&(e=e.substring(0,e.length-3)),e},formatObj2Str(e){if(typeof e=="object")for(const t in e){let a="";return obj.hasOwnProperty(t)&&(a+=`${t}: ${obj[t]}; `),a}else return e},compareModelsAnswer(){let e=this.models.filter(t=>t.status===1).map(t=>t.answer);return e.length<2?(this.finalAnswer=e.length===1?e[0]:"",Promise.resolve()):this.$axios.post("/api/chat/completion",this.createFinalAnswerForm(e)).then(t=>{try{this.finalAnswer=P(t.data.$response,["finalAnswer","finalAnswerIndex"]).finalAnswer}catch(a){console.error(a),this.$message.error("无法解析最终答案")}})},createFinalAnswerForm(e){return{messages:[{role:"user",content:`比较问题的多个答案，先理解并自己得出答案，推理并评估后给出我提供的答案中最准确的一个 
问题：
`+this.config.question+`
`+e.map((a,p)=>`answer${p+1}: 
${a}`).join(`
`)+`
你必须遵守下面的规则：
- 用中文回答我。
- 必须按照下面的格式回答我：
finalAnswer: 
<最准确的答案> 
finalAnswerIndex: 
<第几个答案> 
`}],temperature:.1,model:"gpt-3.5-turbo"}},add2Library(){let e={question:this.config.question,answer:this.finalAnswer,knowledge:this.models[0].knowledge};this.loadingOfLibrary=!0,this.$axios.post("/api/questionLibrary/add",e).then(t=>{this.$message.success("已添加到知识库")}).finally(()=>this.loadingOfLibrary=!1)},onImgUploadSuccess(e,t){let a=this.$fileserver.fileurl(e.data.url);a="http://110.40.186.52:10001/static/9530d2d630a04fce9866ae826314e60b.jpg",this.loadingocr=!0,this.$axios.post(`/api/ocr/url2text?url=${a}&service=mathPixOCRService`).then(p=>{this.config.question=p.data}).finally(()=>this.loadingocr=!1)}}},V=e=>(B("data-v-8fce51dd"),e=e(),N(),e),H={class:"container-wrapper"},G=V(()=>r("div",{class:"card-header"},[r("span",null,"设置")],-1)),J=V(()=>r("span",null,"题目",-1)),K={class:"card-header"},Q=V(()=>r("span",null,"解题",-1)),X={class:"result-wrapper"},Y=V(()=>r("div",{class:"card-header"},[r("span",null,"模型答案")],-1)),Z={class:"multi-answer-container"},ee={style:{"margin-bottom":"10px"}},te={class:"card-header"};function se(e,t,a,p,l,g){const d=i("el-button"),w=i("el-upload"),R=i("el-input"),z=i("el-form-item"),L=i("el-form"),U=i("el-scrollbar"),y=i("el-card"),S=i("arrow-down"),j=i("el-icon"),F=i("el-dropdown-item"),D=i("el-dropdown-menu"),I=i("el-dropdown"),_=i("el-text"),m=i("custom-input"),O=i("el-empty"),q=$("loading");return f(),b("div",H,[n(y,{class:"left-bar"},{header:o(()=>[G]),default:o(()=>[n(U,null,{default:o(()=>[n(L,{ref:"configForm",model:l.config,class:"form-config","label-position":"top",rules:l.configRules},{default:o(()=>[n(z,{class:"form-question",label:"题目：",prop:"question"},{label:o(()=>[J,n(w,{action:e.$fileserver.uploadUrl,accept:"image/*","show-file-list":!1,"on-success":g.onImgUploadSuccess,class:"pic-uploader"},{default:o(()=>[n(d,{loading:l.loadingocr,size:"small",type:"primary",icon:"pictureFilled"},null,8,["loading"])]),_:1},8,["action","on-success"])]),default:o(()=>[n(R,{modelValue:l.config.question,"onUpdate:modelValue":t[0]||(t[0]=s=>l.config.question=s),autosize:{minRows:7,maxRows:10},type:"textarea"},null,8,["modelValue"])]),_:1}),n(z,{label:"提示预览：",prop:"promot"},{default:o(()=>[n(R,{modelValue:l.config.promot,"onUpdate:modelValue":t[1]||(t[1]=s=>l.config.promot=s),autosize:{minRows:7,maxRows:10},type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1}),n(y,{class:"right-content"},{header:o(()=>[r("div",K,[Q,r("div",null,[n(d,{class:"button",type:"primary",onClick:g.add2Library,loading:l.loadingOfLibrary},{default:o(()=>[u("添加到知识库")]),_:1},8,["onClick","loading"]),n(I,{style:{margin:"0 12px"},onCommand:g.downloadPDF},{dropdown:o(()=>[n(D,null,{default:o(()=>[n(F,{command:"v1"},{default:o(()=>[u("V1")]),_:1}),n(F,{command:"v2"},{default:o(()=>[u("V2")]),_:1})]),_:1})]),default:o(()=>[n(d,{loading:l.loadingPDF,onClick:t[2]||(t[2]=s=>g.downloadPDF("v2")),type:"primary"},{default:o(()=>[u(" 下载PDF "),n(j,{class:"el-icon--right"},{default:o(()=>[n(S)]),_:1})]),_:1},8,["loading"])]),_:1},8,["onCommand"]),n(d,{class:"button",type:"primary",onClick:t[3]||(t[3]=s=>g.resetModels(l.models))},{default:o(()=>[u("清空")]),_:1}),n(d,{class:"button",type:"primary",onClick:g.solveWithAll,style:{"margin-right":"10px"}},{default:o(()=>[u("一键解题")]),_:1},8,["onClick"])])])]),default:o(()=>[n(U,null,{default:o(()=>[h((f(),b("div",X,[n(y,{class:"box-card multi-answer"},{header:o(()=>[Y]),default:o(()=>[r("div",Z,[r("div",ee,[n(_,{tag:"p",class:"content-text",size:"large"},{default:o(()=>[u("最终答案： "),n(_,{type:"success"},{default:o(()=>[u(A(l.accuracy?`Accuracy=${l.accuracy}%`:""),1)]),_:1})]),_:1}),n(m,{modelValue:l.finalAnswer,"onUpdate:modelValue":t[4]||(t[4]=s=>l.finalAnswer=s),type:"textarea",autosize:{minRows:1},disabled:!l.solved,color:"success"},null,8,["modelValue","disabled"])]),(f(!0),b(C,null,k(l.models,s=>(f(),b("div",{key:s.model,style:{"margin-bottom":"10px"}},[n(_,{tag:"p",class:"content-text",size:"large"},{default:o(()=>[u(A(s.model+":"),1)]),_:2},1024),s.status===-1?(f(),x(m,{key:0,"model-value":"解题失败..",type:"textarea",color:"danger",autosize:{minRows:1},disabled:""})):(f(),x(m,{key:1,modelValue:s.answer,"onUpdate:modelValue":c=>s.answer=c,type:"textarea",autosize:{minRows:1},disabled:s.status===0},null,8,["modelValue","onUpdate:modelValue","disabled"]))]))),128))])]),_:1}),(f(!0),b(C,null,k(l.models,s=>(f(),x(y,{key:s.model,class:"box-card"},{header:o(()=>[r("div",te,[r("span",null,A(s.model),1)])]),default:o(()=>[h((f(),x(U,{height:"300px"},{default:o(()=>[h(n(O,{description:" "},null,512),[[v,s.status===0]]),h(r("div",null,[n(_,{tag:"p",class:"content-text",size:"large",type:"primary"},{default:o(()=>[u("定义：")]),_:1}),n(m,{modelValue:s.definition,"onUpdate:modelValue":c=>s.definition=c,type:"textarea",autosize:{minRows:1},disabled:s.status===0},null,8,["modelValue","onUpdate:modelValue","disabled"]),n(_,{tag:"p",class:"content-text",size:"large",type:"primary"},{default:o(()=>[u("定理：")]),_:1}),n(m,{modelValue:s.theorem,"onUpdate:modelValue":c=>s.theorem=c,type:"textarea",autosize:{minRows:1},disabled:s.status===0},null,8,["modelValue","onUpdate:modelValue","disabled"]),n(_,{tag:"p",class:"content-text",size:"large",type:"primary"},{default:o(()=>[u("解题过程：")]),_:1}),n(m,{modelValue:s.process,"onUpdate:modelValue":c=>s.process=c,type:"textarea",autosize:{minRows:1},disabled:s.status===0},null,8,["modelValue","onUpdate:modelValue","disabled"]),n(_,{tag:"p",class:"content-text",size:"large",type:"primary"},{default:o(()=>[u("答案：")]),_:1}),n(m,{modelValue:s.answer,"onUpdate:modelValue":c=>s.answer=c,type:"textarea",autosize:{minRows:1},disabled:s.status===0},null,8,["modelValue","onUpdate:modelValue","disabled"])],512),[[v,s.status===1]]),h(r("div",null,[n(m,{modelValue:s.answer,"onUpdate:modelValue":c=>s.answer=c,type:"textarea",autosize:{minRows:1},color:"warning",disabled:s.status===0},null,8,["modelValue","onUpdate:modelValue","disabled"])],512),[[v,s.status===2]]),h(r("div",null,[n(_,{tag:"p",class:"content-text",size:"large",type:"danger"},{default:o(()=>[u("错误：")]),_:1}),n(m,{modelValue:s.answer,"onUpdate:modelValue":c=>s.answer=c,type:"textarea",autosize:{minRows:1},color:"danger",disabled:!0},null,8,["modelValue","onUpdate:modelValue"])],512),[[v,s.status===-1]])]),_:2},1024)),[[q,s.loading]])]),_:2},1024))),128))])),[[q,l.loading]])]),_:1})]),_:1})])}const ae=M(T,[["render",se],["__scopeId","data-v-8fce51dd"]]);export{ae as default};
